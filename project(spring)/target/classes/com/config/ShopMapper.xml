<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ShopMapper">

	<insert id="insertReview" parameterType="hashmap">
		insert into review(rvnum, rvContent, mId, rvWritedate, sCode)
		values(0, #{reviewContent}, #{mId}, sysdate, #{sCode} )
	</insert>

	<select id="checkReview" parameterType="hashmap" resultType="ReviewDTO">
		select * from review
		where mId = #{mId} and sCode = #{sCode}
	</select>
	
	<update id="updateReview" parameterType="hashmap">
		update review 
		set rvWriteDate = sysdate, rvContent = #{reviewContent}
		where mId = #{mId} and sCode = #{sCode}
	</update>
	
	<insert id="insertGoodScore" parameterType="hashmap">
		insert All
		<foreach collection="goodKeyword" item="keyword">
			into score (keyword, scode, good, bad, mId)
			values(#{keyword}, #{sCode}, 1, 0, #{mId})
		</foreach>  SELECT * FROM DUAL
	</insert>
	
	
	<insert id="insertBadScore" parameterType="hashmap">
		insert All
		<foreach collection="badKeyword" item="keyword">
			into score (keyword, scode, good, bad, mId)
			values(#{keyword}, #{sCode}, 0, 1, #{mId})
		</foreach>  SELECT * FROM DUAL
	</insert>
	
	<delete id="deleteScore" parameterType="hashmap">
		delete from score
		<where>
			mId = #{mId} and sCode = #{sCode} and (keyword in
			<foreach collection="goodKeyword" item="keyword" open="(" close=")" separator=",">
				#{keyword}
			</foreach>
			or keyword in 
			<foreach collection="badKeyword" item="keyword" open="(" close=")" separator=",">
				#{keyword}
			</foreach>
			)
		</where>
	</delete>

	<select id="selectReview" parameterType="String" resultType="ReviewDTO">
		select * from review
		where sCode = #{sCode}
	</select>
</mapper>